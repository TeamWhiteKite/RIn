
<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<title>BPM íƒ€ì„ë¼ì¸ íˆ´ (ë‹¤í¬ëª¨ë“œ ì „ìš©)</title>
<style>
    :root {
      --bg: #f9f9f9;
      --fg: #000;
      --field-bg: #fff;
      --border: #ccc;
    }
    body.dark {
      --bg: #1e1e1e;
      --fg: #eaeaea;
      --field-bg: #2d2d2d;
      --border: #555;
    }
    body {
      background: var(--bg);
      color: var(--fg);
      font-family: 'Pretendard', sans-serif;
      padding: 2rem;
      transition: all 0.3s ease;
    }
    label, textarea, input, button {
      display: block;
      width: 100%;
      max-width: 600px;
      margin-top: 1rem;
      font-size: 1rem;
    }
    textarea, input, button, pre {
      background: var(--field-bg);
      color: var(--fg);
      border: 1px solid var(--border);
      padding: 0.5rem;
    }
    textarea { height: 200px; white-space: pre; font-family: monospace; }
    pre { white-space: pre-wrap; word-break: break-word; margin-top: 1rem; }
    strong { display: block; margin-top: 1rem; }
    .toggle-btn {
      margin-top: 2rem;
      font-weight: bold;
      cursor: pointer;
      width: fit-content;
      padding: 0.5rem 1rem;
      background: var(--border);
      border: none;
    }
  </style>
</head>
<body class="dark">
<button class="toggle-btn" onclick="toggleDarkMode()">ğŸŒ— ë‹¤í¬ëª¨ë“œ ì „í™˜</button>
<h1>ğŸµ BPM ê¸°ë°˜ íƒ€ì„ë¼ì¸ ìƒì„±ê¸°</h1>
<label for="bpm">1ï¸âƒ£ BPMì´ ëª‡ì¸ê°€ìš”?</label>
<input id="bpm" placeholder="ì˜ˆ: 110" type="number"/>
<button onclick="calculateFPS()">2ï¸âƒ£ FPS ê³„ì‚° + ë§ˆë””ë‹¹ í”„ë ˆì„ ê³„ì‚°</button>
<p id="fpsResult"></p>
<label for="story">3ï¸âƒ£ ìŠ¤í† ë¦¬ë³´ë“œ ë¼ì¸ì´ ìˆë‚˜ìš”?</label>
<textarea id="story" placeholder="ì˜ˆ: 0. ì¸íŠ¸ë¡œ (4ë§ˆë””): ë™ì‘ â†’ ë™ì‘"></textarea>
<button onclick="generateTimeline()">4ï¸âƒ£ íƒ€ì„ë¼ì¸ ìƒì„±</button>
<h3>5ï¸âƒ£ ë³µì‚¬ ê°€ëŠ¥í•œ ì¶œë ¥</h3>
<pre id="output"></pre>

<script>
    let framesPerBeat = 15;

    function calculateFPS() {
      const bpm = parseFloat(document.getElementById('bpm').value);
      const fps = (bpm * framesPerBeat) / 60;
      document.getElementById('fpsResult').innerText = `FPS: ${fps.toFixed(2)} / 1ë§ˆë””: ${(fps * 4).toFixed(2)}í”„ë ˆì„`;
    }

    function generateTimeline() {
      const lines = document.getElementById('story').value.trim().split('\n');
      let totalFrame = 1;
      let results = [];
      const bpm = parseFloat(document.getElementById('bpm').value);
      const framesPerBar = framesPerBeat * 4;

      for (const lineRaw of lines) {
        const line = lineRaw.replace(/^#+\s*/, '');
        const match = line.match(/(\d+)\.\s*(.*?)\s*\((\d+)ë§ˆë””\)(?::\s*(.*))?/);
        if (!match) continue;
        const [_, index, title, barCountStr, actionsRaw] = match;
        const barCount = parseInt(barCountStr);
        const actions = actionsRaw ? actionsRaw.split('â†’').map(s => s.trim()) : [];

        const start = totalFrame;
        const end = totalFrame + framesPerBar * barCount - 1;
        results.push(`<strong>${index}. ${title} (${barCount}ë§ˆë””) [${start}-${end}í”„ë ˆì„]</strong>`);

        for (let i = 0; i < barCount; i++) {
          const bStart = totalFrame + i * framesPerBar;
          const bEnd = bStart + framesPerBar - 1;
          const action = actions[i] ? `: ${actions[i]}` : '';
          results.push(`- ${i + 1}ë§ˆë”” [${bStart}-${bEnd}í”„ë ˆì„]${action}`);
        }
        results.push('');
        totalFrame = end + 1;
      }

      document.getElementById('output').innerHTML = results.join('\n');
    }

    function toggleDarkMode() {
      document.body.classList.toggle('dark');
    }
  </script>
</body>
</html>
